I"€,<blockquote>
  <p>æœ¬æ–‡æ˜¯å­¦ä¹ ã€ŠElasticsearch æƒå¨æŒ‡å—ã€‹è€Œåšçš„è®°å½•ï¼Œæœ‰è®°å½•ä¸æ¸…çš„åœ°æ–¹ï¼Œæ¨èç›´æ¥å»çœ‹åŸæ–‡http://learnes.net/getting_started/conclusion.htmlï¼Œåœ¨æ­¤æ„Ÿè°¢æœ¬ä¹¦çš„ç¿»è¯‘ç»„</p>
</blockquote>

<h2 id="å®‰è£…">å®‰è£…</h2>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## 1. ä¸‹è½½
curl -L -O http://download.elasticsearch.org/PATH/TO/LATEST/$VERSION.zip
unzip elasticsearch-$VERSION.zip
cd  elasticsearch-$VERSION

## 2. è¿è¡Œ
./bin/elasticsearch

## 3. æµ‹è¯•æ˜¯å¦æˆåŠŸè¿è¡Œ
curl 'http://localhost:9200/?pretty'

### if it success you should see this :
{
   "status": 200,
   "name": "Shrunken Bones",
   "version": {
      "number": "1.4.0",
      "lucene_version": "4.10"
   },
   "tagline": "You Know, for Search"
}
</code></pre></div></div>
<h2 id="åŸºæœ¬ä»‹ç»">åŸºæœ¬ä»‹ç»</h2>
<h3 id="åŸºæœ¬ä»‹ç»-1">åŸºæœ¬ä»‹ç»</h3>
<p>Elasticsearch æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼å¯æ‰©å±•çš„å®æ—¶æœç´¢å’Œåˆ†æå¼•æ“ã€‚å®ƒèƒ½å¸®åŠ©ä½ æœç´¢ã€åˆ†æå’Œæµè§ˆæ•°æ®ï¼Œè€Œå¾€å¾€å¤§å®¶å¹¶æ²¡æœ‰åœ¨æŸä¸ªé¡¹ç›®ä¸€å¼€å§‹å°±é¢„æ–™åˆ°éœ€è¦è¿™äº›åŠŸèƒ½ã€‚Elasticsearch ä¹‹æ‰€ä»¥å‡ºç°å°±æ˜¯ä¸ºäº†é‡æ–°èµ‹äºˆç¡¬ç›˜ä¸­çœ‹ä¼¼æ— ç”¨çš„åŸå§‹æ•°æ®æ–°çš„æ´»åŠ›ã€‚Elasticsearch å¹¶ä¸æ˜¯å•çº¯çš„å…¨æ–‡æœç´¢è¿™ä¹ˆç®€å•ã€‚è¿˜æ”¯æŒç»“æ„åŒ–æœç´¢ã€ç»Ÿè®¡ã€æŸ¥è¯¢è¿‡æ»¤ã€åœ°ç†å®šä½ã€è‡ªåŠ¨å®Œæˆç­‰ã€‚</p>

<p>Elasticsearch æ˜¯ä¸€ä¸ªå»ºç«‹åœ¨å…¨æ–‡æœç´¢å¼•æ“ Apache Lucene(TM) åŸºç¡€ä¸Šçš„æœç´¢å¼•æ“ï¼ŒLucene æ˜¯å½“ä»Šæœ€å…ˆè¿›ï¼Œæœ€é«˜æ•ˆçš„å…¨åŠŸèƒ½å¼€æºæœç´¢å¼•æ“æ¡†æ¶ã€‚ä½†æ˜¯Luceneéå¸¸å¤æ‚ï¼Œæ‰€ä»¥è¯ç”Ÿäº†ESå¯¹äºLuceneçš„ä¸€ä¸ªå°è£…ï¼Œæ–¹ä¾¿å¼€å‘äººå‘˜ä½¿ç”¨ã€‚ESé™¤äº†Luceneçš„æœç´¢åŠŸèƒ½ï¼Œè¿˜æ”¯æŒï¼š</p>
<ul>
  <li>åˆ†å¸ƒå¼å®æ—¶æ–‡ä»¶å­˜å‚¨ï¼Œå¹¶å°†æ¯ä¸€ä¸ªå­—æ®µéƒ½ç¼–å…¥ç´¢å¼•ï¼Œä½¿å…¶å¯ä»¥è¢«æœç´¢ã€‚</li>
  <li>å®æ—¶åˆ†æçš„åˆ†å¸ƒå¼æœç´¢å¼•æ“ã€‚</li>
  <li>å¯ä»¥æ‰©å±•åˆ°ä¸Šç™¾å°æœåŠ¡å™¨ï¼Œå¤„ç†PBçº§åˆ«çš„ç»“æ„åŒ–æˆ–éç»“æ„åŒ–æ•°æ®ã€‚</li>
</ul>

<h3 id="esä¸ä¼ ç»Ÿæ•°æ®åº“çš„å¯¹æ¯”">ESä¸ä¼ ç»Ÿæ•°æ®åº“çš„å¯¹æ¯”</h3>
<p>ESä¹Ÿåˆ†ä¸ºå‡ å±‚ç›®å½•ï¼Œä¸ä¼ ç»Ÿæ•°æ®åº“ç±»æ¯”å¦‚ä¸‹ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>å…³ç³»æ•°æ®åº“     â‡’ æ•°æ®åº“ â‡’ è¡¨    â‡’ è¡Œ    â‡’ åˆ—(Columns)
Elasticsearch  â‡’ ç´¢å¼•   â‡’ ç±»å‹  â‡’ æ–‡æ¡£  â‡’ å­—æ®µ(Fields)
ï¼ˆè¿™ä¸ªç´¢å¼•æ˜¯_indexï¼Œåè¯æ„æ€ï¼Œä¸åè¾¹çš„å»ºç´¢å¼•æ„ä¹‰ä¸åŒï¼‰
</code></pre></div></div>

<p>ä¾‹å¦‚å»ºç«‹ä¸€ä¸ªå‘˜å·¥ä¿¡æ¯è¡¨ï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+ ä¸ºæ¯ä¸€ä¸ªå‘˜å·¥çš„ æ–‡æ¡£ åˆ›å»ºç´¢å¼•ï¼Œæ¯ä¸ª æ–‡æ¡£ éƒ½åŒ…å«äº†ä¸€ä¸ªå‘˜å·¥çš„æ‰€æœ‰ä¿¡æ¯ï¼ˆä¸‹åˆ—1å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ï¼‰ã€‚
+ æ¯ä¸ªæ–‡æ¡£éƒ½ä¼šè¢«æ ‡è®°ä¸º employee ç±»å‹ã€‚ 
+ è¿™ç§ç±»å‹å°†å­˜æ´»åœ¨ megacorp è¿™ä¸ª ç´¢å¼• ä¸­ã€‚
+ è¿™ä¸ªç´¢å¼•å°†ä¼šå­˜å‚¨åœ¨ Elasticsearch çš„é›†ç¾¤ä¸­

curl -XPUT 'http://localhost:9200/megacorp/employee/1'
{
    "first_name" : "John",
    "last_name" :  "Smith",
    "age" :        25,
    "about" :      "I love to go rock climbing",
    "interests": [ "sports", "music" ]
}
</code></pre></div></div>

<h2 id="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ</h2>
<ol>
  <li>ESé€šè¿‡9300ç«¯å£è¿›è¡Œæ•°æ®ä¼ è¾“å’Œé€šä¿¡ï¼Œjavaå¯ä»¥ç›´æ¥é€šè¿‡èŠ‚ç‚¹å®¢æˆ·ç«¯æˆ–ä¼ è¾“å®¢æˆ·ç«¯ï¼ˆ9300ç«¯å£ï¼‰ä¸ESè¿›è¡Œäº¤äº’ï¼Œå…¶ä»–è¯­è¨€ä½¿ç”¨9200ç«¯å£ä¸ESçš„RESTful APIè¿›è¡Œé€šä¿¡</li>
</ol>

<p>é™¤äº†ä»£ç é‡Œé€šè¿‡ä¸Šè¿°å®¢æˆ·ç«¯æˆ–è€…APIä¸ESè¿›è¡Œé€šä¿¡ä»¥å¤–ï¼Œå½“ç„¶è¿˜å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‘½ä»¤curlæ“ä½œ</p>
<h3 id="åŸºæœ¬å‘½ä»¤æ ¼å¼">åŸºæœ¬å‘½ä»¤æ ¼å¼</h3>
<p>å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„curlå‘½ä»¤</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      &lt;1&gt;     &lt;2&gt;                   &lt;3&gt;    &lt;4&gt;
curl -XGET 'http://localhost:9200/_count?pretty' -d '
{  &lt;5&gt;
    "query": {
        "match_all": {}
    }
}
'
1. ç›¸åº”çš„ HTTP è¯·æ±‚æ–¹æ³• æˆ–è€… å˜é‡ : GET, POST, PUT, HEAD æˆ–è€… DELETEã€‚
2. é›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹çš„è®¿é—®åè®®ã€ä¸»æœºåä»¥åŠç«¯å£ã€‚
3. è¯·æ±‚çš„è·¯å¾„ã€‚
4. ä»»æ„ä¸€ä¸ªæŸ¥è¯¢åå†åŠ ä¸Š ?pretty å°±å¯ä»¥ç”Ÿæˆ æ›´åŠ ç¾è§‚ çš„JSONåé¦ˆï¼Œä»¥å¢å¼ºå¯è¯»æ€§ã€‚
5. ä¸€ä¸ª JSON ç¼–ç çš„è¯·æ±‚ä¸»ä½“ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰ã€‚

</code></pre></div></div>
<p>ä¸Šè¿°å‘½ä»¤è¿”å›ç»“æœï¼š</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "count" : 0,
    "_shards" : {
        "total" : 5,
        "successful" : 5,
        "failed" : 0
    }
}
</code></pre></div></div>
<p>å¦‚æœåŠ ä¸Š-iå‚æ•°ï¼ˆ<code class="language-plaintext highlighter-rouge">curl -i -XGET 'localhost:9200/'</code>ï¼‰è¿˜èƒ½å¤Ÿæ˜¾ç¤ºheadä¿¡æ¯</p>

<p><strong>ESå‘½ä»¤éƒ½æ˜¯curlå¼€å¤´,å¤§æ¦‚æ ¼å¼ä¸€è‡´ï¼Œå¦‚<code class="language-plaintext highlighter-rouge">curl -XGET 'http://localhost:9200/_count?pretty'</code>ï¼Œä¸‹æ–‡éƒ½ç®€å†™ä¸º<code class="language-plaintext highlighter-rouge">GET /_count</code></strong></p>

<h3 id="æ£€ç´¢æ–‡æ¡£">æ£€ç´¢æ–‡æ¡£</h3>
<p>è·å–1è¿™ä¸ªæ–‡æ¡£çš„ä¿¡æ¯</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /megacorp/employee/1
</code></pre></div></div>

<h3 id="æ‰¹é‡æ£€ç´¢">æ‰¹é‡æ£€ç´¢</h3>
<p>æ£€ç´¢ä½¿ç”¨_searchå‘½ä»¤<code class="language-plaintext highlighter-rouge">GET /megacorp/employee/_search</code>ï¼Œé»˜è®¤ä¼šè¿”å›æœ€å‰çš„10æ¡æ•°æ®</p>
<h3 id="æŒ‡å®šæ¡ä»¶æ£€ç´¢">æŒ‡å®šæ¡ä»¶æ£€ç´¢</h3>
<p>æ£€ç´¢æŒ‡å®šæ¡ä»¶ç»“æœï¼ˆç»™_searchä¼ é€’å‚æ•°ï¼Œå°±å’Œç½‘é¡µæœç´¢å‚æ•°ä¸€æ ·)match/_search?q=<br />
ï¼ˆæ£€ç´¢å§“ä¸ºSmithçš„å‘˜å·¥ï¼‰</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>å‘½ä»¤ï¼š
GET /megacorp/employee/_search?q=last_name:Smith

ç»“æœå¦‚ä¸‹ï¼š
{
   ...
   "hits": {
      "total":      2,
      "max_score":  0.30685282,
      "hits": [
         {
            ...
            "_source": {
               "first_name":  "John",
               "last_name":   "Smith",
               "age":         25,
               "about":       "I love to go rock climbing",
               "interests": [ "sports", "music" ]
            }
         },
         {
            ...
            "_source": {
               "first_name":  "Jane",
               "last_name":   "Smith",
               "age":         32,
               "about":       "I like to collect rock albums",
               "interests": [ "music" ]
            }
         }
      ]
   }
}
</code></pre></div></div>
<p>ä¸Šé¢è¿˜å¯ä»¥é€šè¿‡Query DSL(Domain Specific Language é¢†åŸŸç‰¹å®šè¯­è¨€)æ¥è¿›è¡Œæœç´¢è¾¾åˆ°ç›¸åŒçš„æ•ˆæœ</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /megacorp/employee/_search
{
    "query" : {
        "match" : {
            "last_name" : "Smith"
        }
    }
}
</code></pre></div></div>
<h3 id="ç»“æœè¿‡æ»¤">ç»“æœè¿‡æ»¤</h3>
<p>åœ¨æœç´¢ä¸­åŠ å…¥filerï¼Œå¯¹ç»“æœè¿‡æ»¤<br />
æ£€ç´¢å§“Smithï¼Œå¹¶ä¸”å¹´é¾„å¤§äº30å²çš„å‘˜å·¥</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /megacorp/employee/_search
{
    "query" : {
        "filtered" : {
            "filter" : {
                "range" : {
                    "age" : { "gt" : 30 } &lt;1&gt;
                }
            },
            "query" : {
                "match" : {
                    "last_name" : "Smith" &lt;2&gt;
                }
            }
        }
    }
}
</code></pre></div></div>
<h3 id="å…¨æ–‡åŒ¹é…match">å…¨æ–‡åŒ¹é…match</h3>
<p>æ£€ç´¢aboutå­—æ®µä¸­æœ‰â€rock climbingâ€çš„è®°å½•</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /megacorp/employee/_search
{
    "query" : {
        "match" : {
            "about" : "rock climbing"
        }
    }
}
</code></pre></div></div>
<p>ä¸Šè¿°å‘½ä»¤ä¼šæŠŠaboutå­—æ®µä¸­å¸¦æœ‰â€rock climbingâ€æˆ–è€…å¸¦æœ‰â€rockâ€,â€climbingâ€çš„è®°å½•æ£€ç´¢å‡ºæ¥ã€‚å½“ç„¶ä¼šç»™ç»“æœåšä¸€ä¸ªè¯„åˆ†ï¼Œéƒ½åŒ…å«çš„ç»“æœä¼šåœ¨æ›´å‰é¢ã€‚</p>

<h3 id="ç²¾ç¡®åŒ¹é…match_phrase">ç²¾ç¡®åŒ¹é…match_phrase</h3>
<p>å¦‚æœä¸Šé¢çš„å®ä¾‹ï¼Œä½ ä¸æƒ³è¦åªåŒ…å«â€rockâ€è¿™ç§éƒ¨åˆ†åŒ¹é…çš„ç»“æœï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨match_phraseæ¥è¿›è¡Œç²¾ç¡®åŒ¹é…</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /megacorp/employee/_search
{
    "query" : {
        "match_phrase" : {
            "about" : "rock climbing"
        }
    }
}
è¿™æ ·å°±åªä¼šè¿”å›aboutå­—æ®µä¸­æ˜ç¡®åŒ…å«"rock climbing"å­—æ®µçš„ç»“æœ
</code></pre></div></div>

<h3 id="é«˜äº®æœç´¢ç»“æœhighlight">é«˜äº®æœç´¢ç»“æœhighlight</h3>
<p>ç»“æœä¸­ä¼šåŒ…å«ä¸€ä¸ªæ–°çš„åå«highlightçš„éƒ¨åˆ†ï¼Œå¹¶å°†å‘½ä¸­çš„éƒ¨åˆ†é«˜äº®æ˜¾ç¤º</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /megacorp/employee/_search
{
    "query" : {
        "match_phrase" : {
            "about" : "rock climbing"
        }
    },
    "highlight": {
        "fields" : {
            "about" : {}
        }
    }
}
</code></pre></div></div>

<h3 id="ç»Ÿè®¡æ±‡æ€»ç±»ä¼¼group-byaggs">ç»Ÿè®¡æ±‡æ€»(ç±»ä¼¼group by)aggs</h3>
<p>ç»Ÿè®¡å‘˜å·¥å…´è¶£çˆ±å¥½</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /megacorp/employee/_search
{
  "aggs": {
    "all_interests": {
      "terms": { "field": "interests" }
    }
  }
}

è¿è¡Œç»“æœï¼š
{
   ...
   "hits": { ... },
   "aggregations": {
      "all_interests": {
         "buckets": [
            {
               "key":       "music",
               "doc_count": 2
            },
            {
               "key":       "forestry",
               "doc_count": 1
            },
            {
               "key":       "sports",
               "doc_count": 1
            }
         ]
      }
   }
}
</code></pre></div></div>
<p>å½“ç„¶è¿˜å¯ä»¥åœ¨æ±‡æ€»ä¸­åŠ å…¥å…¶ä»–æ“ä½œï¼Œä¾‹å¦‚ï¼Œåªæ±‡æ€»å§“Simthçš„å‘˜å·¥ï¼ˆåŠ å…¥matchï¼‰</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /megacorp/employee/_search
{
  "query": {
    "match": {
      "last_name": "smith"
    }
  },
  "aggs": {
    "all_interests": {
      "terms": {
        "field": "interests"
      }
    }
  }
}
</code></pre></div></div>
<p>è¿˜å¯ä»¥è¿›è¡Œå¤šå±‚é¢çš„æ±‡æ€»ç»Ÿè®¡ï¼Œéšæ‰‹ç»Ÿè®¡ä¸€ä¸‹æ¯ä¸ªå…´è¶£çš„å¹³å‡å¹´é¾„</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /megacorp/employee/_search
{
    "aggs" : {
        "all_interests" : {
            "terms" : { "field" : "interests" },
            "aggs" : {
                "avg_age" : {
                    "avg" : { "field" : "age" }
                }
            }
        }
    }
}
ç»“æœå¦‚ä¸‹ï¼š
 "all_interests": {
     "buckets": [
        {
           "key": "music",
           "doc_count": 2,
           "avg_age": {
              "value": 28.5
           }
        },
        {
           "key": "forestry",
           "doc_count": 1,
           "avg_age": {
              "value": 35
           }
        },
        {
           "key": "sports",
           "doc_count": 1,
           "avg_age": {
              "value": 25
           }
        }
     ]
  }
</code></pre></div></div>
:ET