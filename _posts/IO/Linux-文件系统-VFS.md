[TOC]

# Linux VFS文件系统

## 概念

**VFS**（[Virtual](https://so.csdn.net/so/search?q=Virtual&spm=1001.2101.3001.7020) Filesystem Switch）称为虚拟文件系统或虚拟文件系统转换，是一个内核软件层，在具体的文件系统之上抽象的一层，用来处理与Posix文件系统相关的所有调用，表现为能够给各种文件系统提供一个通用的接口，使上层的应用程序能够使用通用的接口访问不同文件系统，同时也为不同文件系统的通信提供了媒介。相当于实际文件类型的一个接口。

## 作用

统一文件接口

处理系统调用

完成文件操作

提供内核服务

## 数据结构

### 超级块对象（super block）

**作用：**存放已经安装的文件系统信息。维护整个文件系统的全局信息

**内部结构：**

```
s_type 对应的文件系统类型
s_root 执行文件系统的根目录
s_dirty 超级块所有的脏页索引节点表
...
```

### 索引节点对象（inode）

**作用：**存放文件的元信息，和文件一一对应

**内部结构：**

```
i_ino 索引节点号
i_list 特定状态的索引节点链表
i_mapping 指向文件对应的cache地址空间
...
```

### 文件对象（file）

**作用：**存放打开的文件和进程间交互的相关信息（同一个文件，两个进程打开，就是两个file。进程打开一个文件，就会创建一个file）

**内部结构：**

```
f_list 该文件同一个超级块的其他文件入口
f_dentry 与文件相关的dentry
f_op	指向该文件的文件操作表
f_pos 当前文件偏移量（配合read使用的lseek，就是更改该值）
...
```

### 目录项对象（dentry）

**作用：**存放目录项和文件间的关联信息

**内部结构：**

```
d_inode 对应的索引节点对象
d_parent 父目录对象
d_child 兄弟目录对象链表
d_subdirs 子目录对象链表
d_sb 目录所在超级块
...
```

